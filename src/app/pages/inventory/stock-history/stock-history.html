<div class="card">
    <div class="flex flex-col md:flex-row gap-4 mb-4 justify-between items-start md:items-center">
        <div>
            <h4 class="text-xl font-semibold m-0 mb-2 md:mb-0">Stock Movement History</h4>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
            <!-- Date Range Filter -->
            <p-datepicker [(ngModel)]="rangeDates" selectionMode="range" [readonlyInput]="true"
                placeholder="Select Date Range" styleClass="w-full sm:w-56" [showIcon]="true"
                (onSelect)="applyFilters()" [showButtonBar]="true" (onClearClick)="applyFilters()">
            </p-datepicker>

            <!-- Medicine Filter -->
            <p-select [options]="medicineOptions" [(ngModel)]="selectedMedicine" optionLabel="label" optionValue="value"
                placeholder="Select Medicine" styleClass="w-full sm:w-64" (onChange)="applyFilters()"
                [showClear]="true">
            </p-select>

            <!-- Type Filter -->
            <p-select [options]="typeOptions" [(ngModel)]="selectedType" placeholder="Select Type" class="w-full"
                styleClass="w-full sm:w-48" (onChange)="applyFilters()" [showClear]="true">
            </p-select>

            <!-- Clear Button -->
            <button pButton icon="pi pi-filter-slash" class="p-button-outlined" (click)="clearFilters()"
                pTooltip="Clear All Filters">
                <span class="ml-2 block sm:hidden">Clear</span>
            </button>
        </div>
    </div>

    <p-table [value]="movements()" [paginator]="true" [rows]="10" [loading]="loading" styleClass="p-datatable-gridlines"
        [rowHover]="true">

        <ng-template #header>
            <tr>
                <th pSortableColumn="performedAt">Date <p-sortIcon field="performedAt"></p-sortIcon></th>
                <th pSortableColumn="medicineName">Medicine <p-sortIcon field="medicineName"></p-sortIcon></th>
                <th pSortableColumn="batchNumber">Batch No. <p-sortIcon field="batchNumber"></p-sortIcon></th>
                <th pSortableColumn="movementType">Type <p-sortIcon field="movementType"></p-sortIcon></th>
                <th pSortableColumn="quantity">Quantity <p-sortIcon field="quantity"></p-sortIcon></th>
                <th>Reason</th>
            </tr>
        </ng-template>
        <ng-template #body let-movement>
            <tr>
                <td>{{ movement.performedAt | date:'dd/MM/yyyy HH:mm' }}</td>
                <td>{{ movement.medicineName }}</td>
                <td>{{ movement.batchNumber }}</td>
                <td>
                    <span
                        [class]="'batch-badge status-' + (movement.movementType.startsWith('IN') ? 'instock' : (movement.movementType === 'ADJUSTMENT' ? 'lowstock' : 'outstock'))">
                        {{ movement.movementType }}
                    </span>
                </td>
                <td [class.text-green-600]="movement.quantity > 0" [class.text-red-600]="movement.quantity < 0">
                    {{ movement.quantity > 0 ? '+' : '' }}{{ movement.quantity }}
                </td>
                <td>{{ movement.reason }}</td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="6" class="text-center p-6">
                    <div class="flex flex-col items-center justify-center gap-3">
                        <i class="pi pi-history text-5xl text-gray-400"></i>
                        <span class="text-gray-500 font-medium">No movements found</span>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>