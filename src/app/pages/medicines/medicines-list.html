<div class="card">
  <div class="mb-6">
    <h4 class="text-xl font-semibold text-surface-900 dark:text-surface-0 mb-4">Medicines</h4>
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div class="flex flex-col md:flex-row items-center gap-2 w-full md:w-auto">
        <p-iconfield iconPosition="left" class="w-full md:w-80">
          <p-inputicon styleClass="pi pi-search" />
          <input pInputText type="text" placeholder="Search medicines..." [(ngModel)]="searchQuery"
            (ngModelChange)="onSearch()" class="w-full" />
          <p-inputicon *ngIf="searchQuery" styleClass="pi pi-times cursor-pointer" (click)="clearSearch()" />
        </p-iconfield>
        <p-select [options]="statusOptions" [(ngModel)]="selectedStatus" (onChange)="onStatusChange()"
          placeholder="Select Status" [showClear]="false" styleClass="w-full md:w-40" />
      </div>

      <!-- Mobile Button Wrapper -->
      <div class="w-full md:hidden">
        <p-button label="New Medicine" icon="pi pi-plus" (onClick)="navigateToCreate()" severity="success"
          [outlined]="true" styleClass="w-full">
        </p-button>
      </div>

      <!-- Desktop Button Wrapper -->
      <div class="hidden md:block">
        <p-button label="New Medicine" icon="pi pi-plus" (onClick)="navigateToCreate()" severity="success"
          styleClass="w-auto flex-shrink-0 [&_.p-button-label]:md:hidden [&_.p-button-label]:lg:inline-block">
        </p-button>
      </div>
    </div>
  </div>

  <p-table [value]="medicines" [loading]="loading" [lazy]="true" [lazyLoadOnInit]="true" [paginator]="true"
    sortField="name" [sortOrder]="1" [rows]="pageSize" [totalRecords]="totalRecords" [showCurrentPageReport]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" (onLazyLoad)="loadMedicines($event)"
    styleClass="p-datatable-gridlines">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="medicineCode">
          Medicine Code
          <p-sortIcon field="medicineCode" />
        </th>
        <th pSortableColumn="name">
          Name
          <p-sortIcon field="name" />
        </th>
        <th>Generic Name</th>
        <th>Manufacturer</th>
        <th pSortableColumn="categoryName">
          Category
          <p-sortIcon field="categoryName" />
        </th>
        <th>Unit of Measure</th>
        <th>Status</th>
        <th style="width: 150px">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-medicine>
      <tr>
        <td>{{ medicine.medicineCode }}</td>
        <td>{{ medicine.name }}</td>
        <td>{{ medicine.genericName || '-' }}</td>
        <td>{{ medicine.manufacturer || '-' }}</td>
        <td>{{ medicine.categoryName }}</td>
        <td>{{ medicine.unitOfMeasure }}</td>
        <td>
          <p-tag [value]="medicine.isActive ? 'Active' : 'Inactive'"
            [severity]="medicine.isActive ? 'success' : 'danger'" />
        </td>
        <td>
          <div class="flex gap-2">
            <p-button icon="pi pi-pencil" [rounded]="true" [text]="true" severity="info"
              (onClick)="navigateToEdit(medicine.id)" pTooltip="Edit" tooltipPosition="top" />
            <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
              (onClick)="confirmDelete(medicine)" pTooltip="Delete" tooltipPosition="top" />
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="8" class="text-center py-8">
          <div class="flex flex-col items-center justify-center text-surface-500">
            <i class="pi pi-inbox text-4xl mb-3"></i>
            <p class="text-lg">No medicines found</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-confirmDialog />
<p-toast />